'use strict';$(document).ready(function(){checkDocumentVisibility(checkLogin);lilt();$("#useBarcodeScanner").click(function(e){e.preventDefault();$("#itemCode").focus();});$("#createItem").click(function(){$("#itemsListDiv").toggleClass("col-sm-8","col-sm-12");$("#createNewItemDiv").toggleClass('hidden');$("#itemName").focus();});$(".cancelAddItem").click(function(){document.getElementById("addNewItemForm").reset();$("#createNewItemDiv").addClass('hidden');$("#itemsListDiv").attr('class',"col-sm-12");});$("#gen4me").click(function(){if($("#gen4me").prop("checked")){var codeExist=false;do{var rand=Math.random().toString(36).slice(2).substring(0,10).toUpperCase();$("#itemCode").val(rand);$("#itemCodeErr").text('');$.ajax({type:'get',url:appRoot+"items/gettablecol/id/code/"+rand,success:function(returnedData){codeExist=returnedData.status;}});}
while(codeExist);}
else{$("#itemCode").val("");}});$("#addNewItem").click(function(e){e.preventDefault();changeInnerHTML(['itemNameErr','itemQuantityErr','itemPriceErr','itemCodeErr','addCustErrMsg'],"");var itemName=$("#itemName").val();var itemQuantity=$("#itemQuantity").val();var itemPrice=$("#itemPrice").val().replace(",","");var itemCode=$("#itemCode").val();var itemDescription=$("#itemDescription").val();if(!itemName||!itemQuantity||!itemPrice||!itemCode){!itemName?$("#itemNameErr").text("required"):"";!itemQuantity?$("#itemQuantityErr").text("required"):"";!itemPrice?$("#itemPriceErr").text("required"):"";!itemCode?$("#itemCodeErr").text("required"):"";$("#addCustErrMsg").text("One or more required fields are empty");return;}
displayFlashMsg("Adding Item '"+itemName+"'","fa fa-spinner faa-spin animated",'','');$.ajax({type:"post",url:appRoot+"items/add",data:{itemName:itemName,itemQuantity:itemQuantity,itemPrice:itemPrice,itemDescription:itemDescription,itemCode:itemCode},success:function(returnedData){if(returnedData.status===1){changeFlashMsgContent(returnedData.msg,"text-success",'',1500);document.getElementById("addNewItemForm").reset();lilt();$("#itemCode").focus();}
else{hideFlashMsg();$("#itemNameErr").text(returnedData.itemName);$("#itemPriceErr").text(returnedData.itemPrice);$("#itemCodeErr").text(returnedData.itemCode);$("#itemQuantityErr").text(returnedData.itemQuantity);$("#addCustErrMsg").text(returnedData.msg);}},error:function(){if(!navigator.onLine){changeFlashMsgContent("You appear to be offline. Please reconnect to the internet and try again","","red","");}
else{changeFlashMsgContent("Unable to process your request at this time. Pls try again later!","","red","");}}});});$("#itemsListPerPage, #itemsListSortBy").change(function(){displayFlashMsg("Please wait...",spinnerClass,"","");lilt();});$("#itemSearch").keyup(function(){var value=$(this).val();if(value){$.ajax({url:appRoot+"search/itemsearch",type:"get",data:{v:value},success:function(returnedData){$("#itemsListTable").html(returnedData.itemsListTable);}});}
else{displayFlashMsg("Loading page...",spinnerClass,"","");lilt();}});$("#itemsListTable").on('click',".editItem",function(e){e.preventDefault();var itemId=$(this).attr('id').split("-")[1];var itemDesc=$("#itemDesc-"+itemId).attr('title');var itemName=$("#itemName-"+itemId).html();var itemPrice=$("#itemPrice-"+itemId).html().split(".")[0].replace(",","");var itemCode=$("#itemCode-"+itemId).html();$("#itemIdEdit").val(itemId);$("#itemNameEdit").val(itemName);$("#itemCodeEdit").val(itemCode);$("#itemPriceEdit").val(itemPrice);$("#itemDescriptionEdit").val(itemDesc);$("#editItemFMsg").html("");$("#itemNameEditErr").html("");$("#itemCodeEditErr").html("");$("#itemPriceEditErr").html("");$("#editItemModal").modal('show');});$("#editItemSubmit").click(function(){var itemName=$("#itemNameEdit").val();var itemPrice=$("#itemPriceEdit").val();var itemDesc=$("#itemDescriptionEdit").val();var itemId=$("#itemIdEdit").val();var itemCode=$("#itemCodeEdit").val();if(!itemName||!itemPrice||!itemId){!itemName?$("#itemNameEditErr").html("Item name cannot be empty"):"";!itemPrice?$("#itemPriceEditErr").html("Item price cannot be empty"):"";!itemId?$("#editItemFMsg").html("Unknown item"):"";return;}
$("#editItemFMsg").css('color','black').html("<i class='"+spinnerClass+"'></i> Processing your request....");$.ajax({method:"POST",url:appRoot+"items/edit",data:{itemName:itemName,itemPrice:itemPrice,itemDesc:itemDesc,_iId:itemId,itemCode:itemCode}}).done(function(returnedData){if(returnedData.status===1){$("#editItemFMsg").css('color','green').html("Item successfully updated");setTimeout(function(){$("#editItemModal").modal('hide');},1000);lilt();}
else{$("#editItemFMsg").css('color','red').html("One or more required fields are empty or not properly filled");$("#itemNameEditErr").html(returnedData.itemName);$("#itemCodeEditErr").html(returnedData.itemCode);$("#itemPriceEditErr").html(returnedData.itemPrice);}}).fail(function(){$("#editItemFMsg").css('color','red').html("Unable to process your request at this time. Please check your internet connection and try again");});});$("#itemsListTable").on('click','.updateStock',function(){var itemId=$(this).attr('id').split("-")[1];var itemName=$("#itemName-"+itemId).html();var itemCurQuantity=$("#itemQuantity-"+itemId).html();var itemCode=$("#itemCode-"+itemId).html();$("#stockUpdateItemId").val(itemId);$("#stockUpdateItemName").val(itemName);$("#stockUpdateItemCode").val(itemCode);$("#stockUpdateItemQInStock").val(itemCurQuantity);$("#updateStockModal").modal('show');});$("#stockUpdateType").on('change',function(){var updateType=$("#stockUpdateType").val();if(updateType&&(updateType==='newStock')){$("#stockUpdateDescription").val("New items were purchased");}
else{$("#stockUpdateDescription").val("");}});$("#stockUpdateSubmit").click(function(){var updateType=$("#stockUpdateType").val();var stockUpdateQuantity=$("#stockUpdateQuantity").val();var stockUpdateDescription=$("#stockUpdateDescription").val();var itemId=$("#stockUpdateItemId").val();if(!updateType||!stockUpdateQuantity||!stockUpdateDescription||!itemId){!updateType?$("#stockUpdateTypeErr").html("required"):"";!stockUpdateQuantity?$("#stockUpdateQuantityErr").html("required"):"";!stockUpdateDescription?$("#stockUpdateDescriptionErr").html("required"):"";!itemId?$("#stockUpdateItemIdErr").html("required"):"";return;}
$("#stockUpdateFMsg").html("<i class='"+spinnerClass+"'></i> Updating Stock.....");$.ajax({method:"POST",url:appRoot+"items/updatestock",data:{_iId:itemId,_upType:updateType,qty:stockUpdateQuantity,desc:stockUpdateDescription}}).done(function(returnedData){if(returnedData.status===1){$("#stockUpdateFMsg").html(returnedData.msg);lilt();document.getElementById("updateStockForm").reset();setTimeout(function(){$("#updateStockModal").modal('hide');$("#stockUpdateFMsg").html("");},1000);}
else{$("#stockUpdateFMsg").html(returnedData.msg);$("#stockUpdateTypeErr").html(returnedData._upType);$("#stockUpdateQuantityErr").html(returnedData.qty);$("#stockUpdateDescriptionErr").html(returnedData.desc);}}).fail(function(){$("#stockUpdateFMsg").html("Unable to process your request at this time. Please check your internet connection and try again");});});$("#itemCode").keypress(function(e){if(e.which===13){e.preventDefault();$("#itemName").focus();}});$("#itemsListTable").on('click','.delItem',function(e){e.preventDefault();var itemId=$(this).parents('tr').find('.curItemId').val();var itemRow=$(this).closest('tr');if(itemId){var confirm=window.confirm("Are you sure you want to delete item? This cannot be undone.");if(confirm){displayFlashMsg('Please wait...',spinnerClass,'black');$.ajax({url:appRoot+"items/delete",method:"POST",data:{i:itemId}}).done(function(rd){if(rd.status===1){$(itemRow).remove();resetItemSN();changeFlashMsgContent('Item deleted','','green',1000);}
else{}}).fail(function(){console.log('Req Failed');});}}});});function lilt(url){var orderBy=$("#itemsListSortBy").val().split("-")[0];var orderFormat=$("#itemsListSortBy").val().split("-")[1];var limit=$("#itemsListPerPage").val();$.ajax({type:'get',url:url?url:appRoot+"items/lilt/",data:{orderBy:orderBy,orderFormat:orderFormat,limit:limit},success:function(returnedData){hideFlashMsg();$("#itemsListTable").html(returnedData.itemsListTable);},error:function(){}});return false;}
function vittrhist(itemId){if(itemId){}
return false;}
function resetItemSN(){$(".itemSN").each(function(i){$(this).html(parseInt(i)+1);});}